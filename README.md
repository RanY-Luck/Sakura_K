### åç«¯æŠ€æœ¯

- [Python3](https://www.python.org/downloads/windows/)ï¼šç†Ÿæ‚‰ python3 åŸºç¡€è¯­æ³•
- [FastAPI](https://fastapi.tiangolo.com/zh/) - ç†Ÿæ‚‰åå°æ¥å£ Web æ¡†æ¶.
- [Typer](https://typer.tiangolo.com/) - ç†Ÿæ‚‰å‘½ä»¤è¡Œå·¥å…·çš„ä½¿ç”¨
- [MySQL](https://www.mysql.com/) å’Œ [MongoDB](https://www.mongodb.com/) å’Œ [Redis](https://redis.io/)  - ç†Ÿæ‚‰æ•°æ®å­˜å‚¨æ•°æ®åº“
- [iPæŸ¥è¯¢æ¥å£æ–‡æ¡£](https://user.ip138.com/ip/doc)ï¼šIPæŸ¥è¯¢ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œæœ‰1000æ¬¡çš„å…è´¹æ¬¡æ•°

### PCç«¯

- [node](https://gitee.com/link?target=http%3A%2F%2Fnodejs.org%2F)
  å’Œ [git](https://gitee.com/link?target=https%3A%2F%2Fgit-scm.com%2F) - é¡¹ç›®å¼€å‘ç¯å¢ƒ
- [Vite](https://gitee.com/link?target=https%3A%2F%2Fvitejs.dev%2F) - ç†Ÿæ‚‰ vite ç‰¹æ€§
- [Vue3](https://gitee.com/link?target=https%3A%2F%2Fv3.vuejs.org%2F) - ç†Ÿæ‚‰ Vue åŸºç¡€è¯­æ³•
- [TypeScript](https://gitee.com/link?target=https%3A%2F%2Fwww.typescriptlang.org%2F) - ç†Ÿæ‚‰ `TypeScript` åŸºæœ¬è¯­æ³•
- [Es6+](https://gitee.com/link?target=http%3A%2F%2Fes6.ruanyifeng.com%2F) - ç†Ÿæ‚‰ es6 åŸºæœ¬è¯­æ³•
- [Vue-Router-Next](https://gitee.com/link?target=https%3A%2F%2Fnext.router.vuejs.org%2F) - ç†Ÿæ‚‰ vue-router åŸºæœ¬ä½¿ç”¨
- [Element-Plus](https://gitee.com/link?target=https%3A%2F%2Felement-plus.org%2F) - element-plus åŸºæœ¬ä½¿ç”¨
- [Mock.js](https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fnuysoft%2FMock) - mockjs åŸºæœ¬è¯­æ³•
- [vue3-json-viewer](https://gitee.com/isfive/vue3-json-viewer)ï¼šç®€å•æ˜“ç”¨çš„jsonå†…å®¹å±•ç¤ºç»„ä»¶,é€‚é…vue3å’Œviteã€‚
- [SortableJS/vue.draggable.next](https://github.com/SortableJS/vue.draggable.next)ï¼šVue ç»„ä»¶ ï¼ˆVue.js 3.0ï¼‰
  å…è®¸æ‹–æ”¾å’Œä¸è§†å›¾æ¨¡å‹æ•°ç»„åŒæ­¥ã€‚
- [é«˜å¾·åœ°å›¾API (amap.com)](https://lbs.amap.com/api/jsapi-v2/guide/webcli/map-vue1)ï¼šåœ°å›¾ JSAPI 2.0 æ˜¯é«˜å¾·å¼€æ”¾å¹³å°å…è´¹æä¾›çš„ç¬¬å››ä»£
  Web åœ°å›¾æ¸²æŸ“å¼•æ“ã€‚

### å®šæ—¶ä»»åŠ¡

- [Python3](https://www.python.org/downloads/windows/) -ç†Ÿæ‚‰ python3 åŸºç¡€è¯­æ³•
- [APScheduler](https://github.com/agronholm/apscheduler) - ç†Ÿæ‚‰å®šæ—¶ä»»åŠ¡æ¡†æ¶
- [MongoDB](https://www.mongodb.com/) å’Œ [Redis](https://redis.io/)  - ç†Ÿæ‚‰æ•°æ®å­˜å‚¨æ•°æ®åº“

### å‡†å¤‡å·¥ä½œ

```text
Python == 3.10 (å…¶ä»–ç‰ˆæœ¬å‡æœªæµ‹è¯•)
nodejs >= 14.0 (æ¨èä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆ)
Mysql >= 8.0
MongoDB (æ¨èä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆ)
Redis (æ¨èä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆ)
```

### åç«¯

1. å®‰è£…ä¾èµ–

```text
pip3 install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/
```

2. ä¿®æ”¹é¡¹ç›®æ•°æ®åº“é…ç½®ä¿¡æ¯
   åœ¨ `application/config` ç›®å½•ä¸­

- development_example.pyï¼šå¼€å‘ç¯å¢ƒå¡«å†™æ¨¡æ¿ï¼Œéœ€è¦å•ç‹¬å¤åˆ¶å‡ºæ¥åˆ é™¤**_example**

- production_example.pyï¼šç”Ÿäº§ç¯å¢ƒå¡«å†™æ¨¡æ¿ï¼Œéœ€è¦å•ç‹¬å¤åˆ¶å‡ºæ¥åˆ é™¤**_example**

```python
"""
Mysql æ•°æ®åº“é…ç½®é¡¹
è¿æ¥å¼•æ“å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.osgeo.cn/sqlalchemy/core/engines.html
æ•°æ®åº“é“¾æ¥é…ç½®è¯´æ˜ï¼šmysql+asyncmy://æ•°æ®åº“ç”¨æˆ·å:æ•°æ®åº“å¯†ç @æ•°æ®åº“åœ°å€:æ•°æ®åº“ç«¯å£/æ•°æ®åº“åç§°
"""
SQLALCHEMY_DATABASE_URL = "mysql+asyncmy://æ•°æ®åº“ç”¨æˆ·å:æ•°æ®åº“å¯†ç @æ•°æ®åº“åœ°å€:æ•°æ®åº“ç«¯å£/æ•°æ®åº“åç§°"
SQLALCHEMY_DATABASE_TYPE = "mysql"

"""
Redis æ•°æ®åº“é…ç½®
"""
REDIS_DB_ENABLE = True
REDIS_DB_URL = "redis://:å¯†ç @åœ°å€:ç«¯å£/æ•°æ®åº“"

"""
MongoDB æ•°æ®åº“é…ç½®
"""
MONGO_DB_ENABLE = True
MONGO_DB_NAME = "æ•°æ®åº“åç§°"
MONGO_DB_URL = f"mongodb://ç”¨æˆ·å:å¯†ç @åœ°å€:ç«¯å£/?authSource={MONGO_DB_NAME}"

"""
é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSSé…ç½®
é˜¿é‡Œäº‘è´¦å·AccessKeyæ‹¥æœ‰æ‰€æœ‰APIçš„è®¿é—®æƒé™ï¼Œé£é™©å¾ˆé«˜ã€‚å¼ºçƒˆå»ºè®®æ‚¨åˆ›å»ºå¹¶ä½¿ç”¨RAMç”¨æˆ·è¿›è¡ŒAPIè®¿é—®æˆ–æ—¥å¸¸è¿ç»´ï¼Œè¯·ç™»å½•RAMæ§åˆ¶å°åˆ›å»ºRAMç”¨æˆ·ã€‚
yourEndpointå¡«å†™Bucketæ‰€åœ¨åœ°åŸŸå¯¹åº”çš„Endpointã€‚ä»¥åä¸œ1ï¼ˆæ­å·ï¼‰ä¸ºä¾‹ï¼ŒEndpointå¡«å†™ä¸ºhttps://oss-cn-hangzhou.aliyuncs.comã€‚
*  [accessKeyId] {String}ï¼šé€šè¿‡é˜¿é‡Œäº‘æ§åˆ¶å°åˆ›å»ºçš„AccessKeyã€‚
*  [accessKeySecret] {String}ï¼šé€šè¿‡é˜¿é‡Œäº‘æ§åˆ¶å°åˆ›å»ºçš„AccessSecretã€‚
*  [bucket] {String}ï¼šé€šè¿‡æ§åˆ¶å°æˆ–PutBucketåˆ›å»ºçš„bucketã€‚
*  [endpoint] {String}ï¼šbucketæ‰€åœ¨çš„åŒºåŸŸï¼Œ é»˜è®¤oss-cn-hangzhouã€‚
"""
ALIYUN_OSS = {
    "accessKeyId": "accessKeyId",
    "accessKeySecret": "accessKeySecret",
    "endpoint": "endpoint",
    "bucket": "bucket",
    "baseUrl": "baseUrl"
}

"""
è·å–IPåœ°å€å½’å±åœ°
æ–‡æ¡£ï¼šhttps://user.ip138.com/ip/doc
"""
IP_PARSE_ENABLE = True
IP_PARSE_TOKEN = "IP_PARSE_TOKEN"
```
å¹¶åœ¨`alembic.ini`æ–‡ä»¶ä¸­é…ç½®æ•°æ®åº“ä¿¡æ¯ï¼Œç”¨äºæ•°æ®åº“æ˜ å°„

# å¼€å‘ç¯å¢ƒ[dev]
```text
mysql+pymysql://æ•°æ®åº“ç”¨æˆ·å:æ•°æ®åº“å¯†ç @æ•°æ®åº“åœ°å€:æ•°æ®åº“ç«¯å£/æ•°æ®åº“åç§°

version_locations = %(here)s/alembic/versions_dev
sqlalchemy.url = sqlalchemy.url = mysql+asyncmy://root:123456@127.0.0.1:3306/sakura_k
```

# ç”Ÿäº§ç¯å¢ƒ[pro]
```text
mysql+pymysql://æ•°æ®åº“ç”¨æˆ·å:æ•°æ®åº“å¯†ç @æ•°æ®åº“åœ°å€:æ•°æ®åº“ç«¯å£/æ•°æ®åº“åç§°

version_locations = %(here)s/alembic/versions_pro
sqlalchemy.url = sqlalchemy.url = mysql+asyncmy://root:123456@127.0.0.1:3306/sakura_k
```
3. åˆ›å»ºæ•°æ®åº“

```text
mysql> create database sakura_k;  # åˆ›å»ºæ•°æ®åº“
mysql> use sakura_k;           # ä½¿ç”¨å·²åˆ›å»ºçš„æ•°æ®åº“ 
mysql> set names utf8;         # è®¾ç½®ç¼–ç 
```

4. åˆå§‹åŒ–æ•°æ®åº“æ•°æ®

```
# é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼Œéœ€æå‰åˆ›å»ºå¥½æ•°æ®åº“
# ä¼šè‡ªåŠ¨å°†æ¨¡å‹è¿ç§»åˆ°æ•°æ®åº“ï¼Œå¹¶ç”Ÿæˆåˆå§‹åŒ–æ•°æ®
# æ‰§è¡Œå‰è¯·ç¡®è®¤æ‰§è¡Œçš„ç¯å¢ƒä¸settings.pyæ–‡ä»¶ä¸­é…ç½®çš„DEBUGä¸€è‡´
# æ¯”å¦‚è¦åˆå§‹åŒ–å¼€å‘ç¯å¢ƒï¼Œé‚£ä¹ˆenvå‚æ•°åº”è¯¥ä¸º devï¼Œå¹¶ä¸” application/settings.DEBUG åº”è¯¥ = True
# æ¯”å¦‚è¦åˆå§‹åŒ–ç”Ÿäº§ç¯å¢ƒï¼Œé‚£ä¹ˆenvå‚æ•°åº”è¯¥ä¸º proï¼Œå¹¶ä¸” application/settings.DEBUG åº”è¯¥ = False

ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
python3 main.py init

ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
python3 main.py init --env dev
```

5. ä¿®æ”¹é¡¹ç›®åŸºæœ¬é…ç½®ä¿¡æ¯
- ä¿®æ”¹æ•°æ®åº“è¡¨ `vadmin_system_settings` ä¸­çš„å…³é”®ä¿¡æ¯

```text
ã€å¯é€‰é…ç½®ã€‘
# é˜¿é‡Œäº‘çŸ­ä¿¡é…ç½®
sms_access_key
sms_access_key_secret
sms_sign_name_1
sms_template_code_1
sms_sign_name_2
sms_template_code_2

# å¾®ä¿¡å°ç¨‹åºé…ç½®
wx_server_app_id
wx_server_app_secret

# é‚®ç®±é…ç½®
email_access
email_password
email_server
email_port
```

6. å¯åŠ¨

```text
#è¿è¡Œç¨‹åº
python3 main.py run
```

## å…¶ä»–æ“ä½œ

- æ¥å£Swaggeræ–‡æ¡£

```
#åœ¨çº¿æ–‡æ¡£åœ°å€(åœ¨é…ç½®æ–‡ä»¶é‡Œé¢è®¾ç½®è·¯å¾„æˆ–è€…å…³é—­)
http://127.0.0.1:9000/docs
```

- æäº¤ä»£ç æ¨¡æ¿

```
âœ¨ feat:  æ–°å¢
ğŸ Fix: ä¿®å¤
ğŸ“ƒ docs: æ–‡æ¡£
ğŸ¦„ refactor: é‡æ„
ğŸˆ perf: ä¼˜åŒ–
```

- Gitæäº¤ä»£ç 

Gitæ›´æ–°ignoreæ–‡ä»¶ç›´æ¥ä¿®æ”¹gitignoreæ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ï¼Œéœ€è¦å…ˆå»æ‰å·²ç»æ‰˜ç®¡çš„æ–‡ä»¶ï¼Œä¿®æ”¹å®Œæˆä¹‹åå†é‡æ–°æ·»åŠ å¹¶æäº¤ã€‚

```text
ç¬¬ä¸€æ­¥ï¼š
git rm -r --cached .
å»æ‰å·²ç»æ‰˜ç®¡çš„æ–‡ä»¶
ç¬¬äºŒæ­¥ï¼š
ä¿®æ”¹è‡ªå·±çš„igonreæ–‡ä»¶å†…å®¹
ç¬¬ä¸‰æ­¥ï¼š
git add .
git commit -m "clear cached"
```

- æ‰§è¡Œæ•°æ®åº“è¿ç§»å‘½ä»¤ï¼ˆç»ˆç«¯æ‰§è¡Œï¼‰

```text
# æ‰§è¡Œå‘½ä»¤ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ï¼š
python main.py migrate

# æ‰§è¡Œå‘½ä»¤ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼š
python main.py migrate --env dev

# å¼€å‘ç¯å¢ƒçš„åŸå‘½ä»¤ã€éæ‰§è¡Œã€‘
alembic --name dev revision --autogenerate -m 2.0
alembic --name dev upgrade head
```

## æŸ¥æ•°æ®

è‡ªå®šä¹‰çš„ä¸€äº›æŸ¥è¯¢è¿‡æ»¤

```text
# æ—¥æœŸæŸ¥è¯¢
# å€¼çš„ç±»å‹ï¼šstr
# å€¼å¾—æ ¼å¼ï¼š%Y-%m-%dï¼š2023-05-14
å­—æ®µåç§°=("date", å€¼)

# æ¨¡ç³ŠæŸ¥è¯¢
# å€¼çš„ç±»å‹: str
å­—æ®µåç§°=("like", å€¼)

# in æŸ¥è¯¢
# å€¼çš„ç±»å‹ï¼šlist
å­—æ®µåç§°=("in", å€¼)

# æ—¶é—´åŒºé—´æŸ¥è¯¢
# å€¼çš„ç±»å‹ï¼štuple æˆ–è€… list
å­—æ®µåç§°=("between", å€¼)

# æœˆä»½æŸ¥è¯¢
# å€¼çš„ç±»å‹ï¼šstr
# å€¼çš„æ ¼å¼ï¼š%Y-%mï¼š2023-05
å­—æ®µåç§°=("month", å€¼)

# ä¸ç­‰äºæŸ¥è¯¢
å­—æ®µåç§°=("!=", å€¼)

# å¤§äºæŸ¥è¯¢
å­—æ®µåç§°=(">", å€¼)

# ç­‰äº None
å­—æ®µåç§°=("None")

# ä¸ç­‰äº None
å­—æ®µåç§°=("not None")
```

ä»£ç éƒ¨åˆ†ï¼š

```python
def __dict_filter(self, **kwargs) -> list[BinaryExpression]:
    """
    å­—å…¸è¿‡æ»¤
    :param model:
    :param kwargs:
    """
    conditions = []
    for field, value in kwargs.items():
        if value is not None and value != "":
            attr = getattr(self.model, field)
            if isinstance(value, tuple):
                if len(value) == 1:
                    if value[0] == "None":
                        conditions.append(attr.is_(None))
                    elif value[0] == "not None":
                        conditions.append(attr.isnot(None))
                    else:
                        raise CustomException("SQLæŸ¥è¯¢è¯­æ³•é”™è¯¯")
                elif len(value) == 2 and value[1] not in [None, [], ""]:
                    if value[0] == "date":
                        # æ ¹æ®æ—¥æœŸæŸ¥è¯¢ï¼Œ å…³é”®å‡½æ•°æ˜¯ï¼šfunc.time_formatå’Œfunc.date_format
                        conditions.append(func.date_format(attr, "%Y-%m-%d") == value[1])
                    elif value[0] == "like":
                        conditions.append(attr.like(f"%{value[1]}%"))
                    elif value[0] == "in":
                        conditions.append(attr.in_(value[1]))
                    elif value[0] == "between" and len(value[1]) == 2:
                        conditions.append(attr.between(value[1][0], value[1][1]))
                    elif value[0] == "month":
                        conditions.append(func.date_format(attr, "%Y-%m") == value[1])
                    elif value[0] == "!=":
                        conditions.append(attr != value[1])
                    elif value[0] == ">":
                        conditions.append(attr > value[1])
                    elif value[0] == "<=":
                        conditions.append(attr <= value[1])
                    else:
                        raise CustomException("SQLæŸ¥è¯¢è¯­æ³•é”™è¯¯")
            else:
                conditions.append(attr == value)
    return conditions
```

ç¤ºä¾‹ï¼š

æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·idä¸º1æˆ–2æˆ– 4æˆ–6ï¼Œå¹¶ä¸”emailä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°åŒ…æ‹¬æï¼š

```python
users = UserDal(db).get_datas(limit=0, id=("in", [1, 2, 4, 6]), email=("not None",), name=("like", "æ"))

# limit=0ï¼šè¡¨ç¤ºè¿”å›æ‰€æœ‰ç»“æœæ•°æ®
# è¿™é‡Œçš„ get_datas é»˜è®¤è¿”å›çš„æ˜¯ pydantic æ¨¡å‹æ•°æ®
# å¦‚æœéœ€è¦è¿”å›ç”¨æˆ·å¯¹è±¡åˆ—è¡¨ï¼Œä½¿ç”¨å¦‚ä¸‹è¯­å¥ï¼š
users = UserDal(db).get_datas(
    limit=0,
    id=("in", [1, 2, 4, 6]),
    email=("not None",),
    name=("like", "æ"),
    v_return_objs=True
)
```

æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·idä¸º1æˆ–2æˆ– 4æˆ–6ï¼Œå¹¶ä¸”emailä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°åŒ…æ‹¬æï¼š

æŸ¥è¯¢ç¬¬ä¸€é¡µï¼Œæ¯é¡µä¸¤æ¡æ•°æ®ï¼Œå¹¶è¿”å›æ€»æ•°ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡ get_datas å®ç°åŸå§‹æŸ¥è¯¢æ–¹å¼ï¼š

```python
v_where = [VadminUser.id.in_([1, 2, 4, 6]), VadminUser.email.isnot(None), VadminUser.name.like(f"%æ%")]
users, count = UserDal(db).get_datas(limit=2, v_where=v_where, v_return_count=True)

# è¿™é‡Œçš„ get_datas é»˜è®¤è¿”å›çš„æ˜¯ pydantic æ¨¡å‹æ•°æ®
# å¦‚æœéœ€è¦è¿”å›ç”¨æˆ·å¯¹è±¡åˆ—è¡¨ï¼Œä½¿ç”¨å¦‚ä¸‹è¯­å¥ï¼š
users, count = UserDal(db).get_datas(
    limit=2,
    v_where=v_where,
    v_return_count=True,
    v_return_objs=True,
)
```

å¤–é”®æŸ¥è¯¢ç¤ºä¾‹

ä»¥å¸¸è§é—®é¢˜è¡¨ä¸ºä¸»è¡¨ï¼ŒæŸ¥è¯¢å‡ºåˆ›å»ºç”¨æˆ·åç§°ä¸ºrootçš„ç”¨æˆ·ï¼Œåˆ›å»ºäº†å“ªäº›å¸¸è§é—®é¢˜ï¼Œå¹¶åŠ è½½å‡ºç”¨æˆ·ä¿¡æ¯ï¼š

```python
v_options = [joinedload(VadminIssue.create_user)]
v_join = [["create_user"]]
v_where = [VadminUser.name == "root"]
datas = await crud.IssueCategoryDal(auth.db).get_datas(
    limit=0,
    v_options=options,
    v_join=v_join,
    v_where=v_where,
    v_return_objs=True
)
```

macç³»ç»Ÿå®‰è£…è™šæ‹Ÿç¯å¢ƒå’Œæ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
ä¸€ã€å®‰è£…virtualenv
> sudo pip install virtualenv

äºŒã€åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
> virtualenv venv # venvä¸ºè™šæ‹Ÿç¯å¢ƒçš„åç§°ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰

æ³¨æ„ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨Python3åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œéœ€è¦æ·»åŠ --pythoné€‰é¡¹ï¼š
> virtualenv --python=python3 env

ä¸‰ã€æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
> source env/bin/activate

## å¦‚ä½•å¿«é€Ÿå¼€å‘ä¸€ä¸ªæ¥å£
å¾…è¡¥å……
